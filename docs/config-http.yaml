# Twitter MCP Configuration - HTTP mode with full auth and policies
# Use this for production deployments with OAuth/JWT authentication

server:
  name: "twitter-mcp"
  version: "0.1.0"
  transport:
    type: "http"
    http:
      host: ":8080"

middleware:
  access_logs:
    excluded_headers:
      - "Accept"
      - "Accept-Encoding"
    redacted_headers:
      - "Authorization"
      - "Cookie"

  jwt:
    enabled: true
    validation:
      strategy: "local"  # or "forwarded" if using Istio/Envoy
      forwarded_header: "X-Validated-JWT"
      local:
        jwks_uri: "https://your-idp.com/.well-known/jwks.json"
        cache_interval: 5m
        allow_conditions:
          - expression: 'has(payload.scope) && payload.scope.contains("twitter:read")'
          - expression: 'payload.iss == "https://your-idp.com"'

# Tool access policies based on JWT claims
# First matching policy wins - order matters!
policies:
  tools:
    # Admins can do everything
    - expression: 'has(payload.groups) && payload.groups.exists(g, g == "admins")'
      allowed_tools: ["*"]
    
    # Writers can post, like, retweet
    - expression: 'has(payload.groups) && payload.groups.exists(g, g == "writers")'
      allowed_tools:
        - "post_tweet"
        - "delete_tweet"
        - "like_tweet"
        - "unlike_tweet"
        - "retweet"
        - "undo_retweet"
        - "get_*"  # Also allow all read operations
    
    # Readers can only read
    - expression: 'has(payload.groups) && payload.groups.exists(g, g == "readers")'
      allowed_tools:
        - "get_timeline"
        - "get_mentions"
        - "get_trends"
        - "get_me"
        - "get_topics_heat"
        - "search_tweets"
        - "search_topics"
    
    # Users with twitter:write scope can write
    - expression: 'has(payload.scope) && payload.scope.contains("twitter:write")'
      allowed_tools:
        - "post_tweet"
        - "delete_tweet"
        - "like_*"
        - "retweet"
        - "undo_retweet"
    
    # Users with twitter:read scope can read
    - expression: 'has(payload.scope) && payload.scope.contains("twitter:read")'
      allowed_tools:
        - "get_*"
        - "search_*"

oauth_authorization_server:
  enabled: true
  url_suffix: ""
  issuer_uri: "https://your-idp.com"

oauth_protected_resource:
  enabled: true
  url_suffix: ""
  resource: "https://your-twitter-mcp.example.com"
  auth_servers:
    - "https://your-idp.com"
  jwks_uri: "https://your-idp.com/.well-known/jwks.json"
  scopes_supported:
    - "twitter:read"
    - "twitter:write"
  bearer_methods_supported:
    - "header"
  resource_name: "Twitter MCP Server"
  resource_documentation: "https://github.com/achetronic/twitter-mcp"

twitter:
  api_key: "$TWITTER_API_KEY"
  api_key_secret: "$TWITTER_API_KEY_SECRET"
  access_token: "$TWITTER_ACCESS_TOKEN"
  access_token_secret: "$TWITTER_ACCESS_TOKEN_SECRET"
  bearer_token: "$TWITTER_BEARER_TOKEN"
